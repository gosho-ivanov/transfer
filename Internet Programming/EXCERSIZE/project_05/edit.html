<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Edit Employee</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="popup">
    <h2>Edit Employee</h2>

    <form id="editForm" novalidate>

      <label>
        First Name
        <input id="first_name" />
      </label>
      
      <label>
        Middle Name
        <input id="middle_name" />
      </label>

      <label>
        Last Name
        <input id="last_name" />
      </label>

      <label>
        Job Title
        <input id="job_title" />
      </label>

      <label>
        Department ID
        <input id="department_id" type="number" />
      </label>

      <label>
        Salary
        <input id="salary" type="number" step="0.01" />
      </label>

      <label>
        Address ID
        <input id="address_id" type="number" />
      </label>

      <label>
        Manager ID
        <input id="manager_id" type="number" />
      </label>

      <div class="form-actions">
        <button type="submit">Save</button>
        <button id="cancel" type="button">Cancel</button>
      </div>

      <div id="message" class="message"></div>
    </form>
  </main>

  <script src="script.js"></script>
  <script>
    const id = new URLSearchParams(location.search).get('id');
    const msg = document.getElementById('message');

    document.getElementById('cancel').onclick = () => window.close();

    async function load() {
      const e = await window.getEmployeeById(id);
      if (!e) {
        msg.textContent = 'Employee not found.';
        return;
      }

      employee_id.value = e.employee_id;
      first_name.value = e.first_name;
      middle_name.value = e.middle_name ?? '';
      last_name.value = e.last_name;
      job_title.value = e.job_title;
      department_id.value = e.department_id;
      salary.value = e.salary;
      address_id.value = e.address_id ?? '';
      manager_id.value = e.manager_id ?? '';
    }

    editForm.addEventListener('submit', async ev => {
      ev.preventDefault();

      const updated = {
  first_name: first_name.value.trim(),
  middle_name: middle_name.value.trim() || null,
  last_name: last_name.value.trim(),
  job_title: job_title.value.trim(),
  department_id: Number(department_id.value),
  salary: Number(salary.value),
  address_id: address_id.value ? Number(address_id.value) : null,
  manager_id: manager_id.value ? Number(manager_id.value) : null
};


      try {
        await window.updateEmployee(id, updated);
        window.opener?.loadEmployees();
        alert('Employee updated.');
        window.close();
      } catch {
        msg.textContent = 'Update failed.';
      }
    });

    load();
  </script>
</body>
</html>
